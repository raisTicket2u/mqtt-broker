FROM eclipse-mosquitto:2

# Copy config only (not the password file)
COPY --chown=1883:1883 mosquitto/config/mosquitto.conf /mosquitto/config/mosquitto.conf

# Create empty pwfile with correct ownership (passwords added later)
RUN touch /mosquitto/config/pwfile && \
    chown 1883:1883 /mosquitto/config/pwfile && \
    chmod 600 /mosquitto/config/pwfile

# Ensure data dirs are writable
RUN mkdir -p /mosquitto/data /mosquitto/log && \
    chown -R 1883:1883 /mosquitto/data /mosquitto/log

USER mosquitto
